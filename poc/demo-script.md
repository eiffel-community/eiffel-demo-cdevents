# SIG Events Proof of Concept - Demo Script

This document is a walk-through running the PoC, from setting up the environment,
then step-by-step how to run the demo.

## Installation
Install [Eiffel easy2use](https://github.com/eiffel-community/eiffel-easy2use) bundle 
`./easy2use start -t Docker Eiffel`, which installs Jenkins instances, RabbitMQ message broker and other eiffel services required for PoC.

Import the Jenkins job in `eiffel-jenkins-fem` instance using the template [Eiffel_ActF_From_CDEvents_PoC.xml](./eiffel/Eiffel_ActF_From_CDEvents_PoC.xml)
- Download jenkins-cli.jar, go to http://JENKINS_IP:JENKINS_PORT/jnlpJars/jenkins-cli.jar from the browser
- java -jar jenkins-cli.jar -s http://JENKINS_USER:JENKINS_PASSWORD@JENKINS_IP:JENKINS_PORT create-job Eiffel_ActF_From_CDEvents_PoC < [Eiffel_ActF_From_CDEvents_PoC.xml](./eiffel/Eiffel_ActF_From_CDEvents_PoC.xml)
- Note: envinject Jenkins plugin is required for this Job configuration

Upload Subscription from Eiffel Intelligence dashboard(at EIFFEL-BACKEND-ALLEVENTS), using the template [Jenkins_2_CDEvent_SpinnakerPipeline_Finished](./eiffel/Jenkins_2_CDEvent_SpinnakerPipeline_Finished.json)

Install [eiffel-translator-cdevents](https://github.com/eiffel-community/eiffel-translator-cdevents), note the host and port where the `eiffel-translator-cdevents` application is running(required when running ./poc.sh)

From the `poc` folder, run the poc script.
It will create a kind cluster, install and configure all other required components.
The script prerequisites and details are documented within the script itself.

```shell
./poc.sh -e eiffel-translator-host -o eiffel-translator-port
```

Login to the [keptn bridge](https://keptn-127.0.0.1.nip.io/bridge/) with the credentials
generated by `keptn configure bridge -o`. The self-signed certificate is not trusted by the
web-browser, ignore the warning and continue to the bridge.

Make sure you are able to access the Dashboards of Tekton, Spinnaker, Jenkins to monitor the Pipelines running. 

## Running the demo

To kick-off the demo, start the build Tekton pipeline from the `poc` folder:

```shell
tkn pipeline start build-artifact -w name=sources,volumeClaimTemplateFile=./tekton/workspace-template.yaml
```

- Watch the pipeline execution in the [Tekton Dashboard](http://localhost/dashboard)
- Watch the pipeline execution in the [Spinnaker Dashboard](http://spin-ui-127.0.0.1.nip.io)
- Watch the Jenkins job execution in the [Jenkins Dashboard](http://localhost:8052)
- Watch the Keptn sequence progress on the [bridge](https://keptn-127.0.0.1.nip.io/bridge/project/cde/sequence)
- Once the sequence is complete the [link](http://localhost/poc/) in the deployment on the bridge opens the deployed demo app
